<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Busca Avan√ßada de Imagens</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .search-form {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .form-row {
            display: flex;
            gap: 15px;
        }
        .form-row .form-group {
            flex: 1;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            flex: 1;
        }
        button:hover {
            background: #0056b3;
        }
        .results {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .image-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }
        .image-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        .image-info {
            padding: 10px;
        }
        .image-info h4 {
            margin: 0 0 5px 0;
            font-size: 14px;
        }
        .image-info p {
            margin: 0;
            font-size: 12px;
            color: #666;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        .pagination button {
            flex: none;
            padding: 8px 16px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîç Teste - Busca Avan√ßada de Imagens</h1>
        <p>Teste todas as funcionalidades de busca da API</p>
    </div>

    <div class="search-form">
        <h2>Par√¢metros de Busca</h2>
        
        <div class="form-group">
            <label for="searchTerm">Termo de Busca:</label>
            <input type="text" id="searchTerm" placeholder="Digite o nome da imagem...">
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="userId">ID do Usu√°rio:</label>
                <input type="text" id="userId" placeholder="Ex: 123">
            </div>
            <div class="form-group">
                <label for="fileType">Tipo de Arquivo:</label>
                <select id="fileType">
                    <option value="">Todos os tipos</option>
                    <option value="image/jpeg">JPEG</option>
                    <option value="image/png">PNG</option>
                    <option value="image/gif">GIF</option>
                    <option value="image/webp">WebP</option>
                </select>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="minSize">Tamanho M√≠nimo (bytes):</label>
                <input type="number" id="minSize" placeholder="Ex: 102400 (100KB)">
            </div>
            <div class="form-group">
                <label for="maxSize">Tamanho M√°ximo (bytes):</label>
                <input type="number" id="maxSize" placeholder="Ex: 5242880 (5MB)">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="dateFrom">Data De:</label>
                <input type="date" id="dateFrom">
            </div>
            <div class="form-group">
                <label for="dateTo">Data At√©:</label>
                <input type="date" id="dateTo">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="limit">Limite:</label>
                <input type="number" id="limit" value="10" min="1" max="100">
            </div>
            <div class="form-group">
                <label for="offset">Offset:</label>
                <input type="number" id="offset" value="0" min="0">
            </div>
        </div>

        <div class="button-group">
            <button onclick="searchImages()">üîç Buscar</button>
            <button onclick="clearForm()">üóëÔ∏è Limpar</button>
            <button onclick="loadAllImages()">üì∑ Todas as Imagens</button>
        </div>
    </div>

    <div class="results">
        <h2>Resultados</h2>
        <div id="status"></div>
        <div id="imageGrid" class="image-grid"></div>
        <div id="pagination" class="pagination"></div>
    </div>

    <script>
        let currentResults = null;

        async function searchImages() {
            const statusDiv = document.getElementById('status');
            const imageGrid = document.getElementById('imageGrid');
            
            statusDiv.innerHTML = '<div class="status info">Buscando imagens...</div>';
            imageGrid.innerHTML = '';

            try {
                const params = new URLSearchParams();
                
                const searchTerm = document.getElementById('searchTerm').value;
                const userId = document.getElementById('userId').value;
                const fileType = document.getElementById('fileType').value;
                const minSize = document.getElementById('minSize').value;
                const maxSize = document.getElementById('maxSize').value;
                const dateFrom = document.getElementById('dateFrom').value;
                const dateTo = document.getElementById('dateTo').value;
                const limit = document.getElementById('limit').value;
                const offset = document.getElementById('offset').value;

                if (searchTerm) params.append('search', searchTerm);
                if (userId) params.append('user_id', userId);
                if (fileType) params.append('file_type', fileType);
                if (minSize) params.append('min_size', minSize);
                if (maxSize) params.append('max_size', maxSize);
                if (dateFrom) params.append('date_from', dateFrom);
                if (dateTo) params.append('date_to', dateTo);
                if (limit) params.append('limit', limit);
                if (offset) params.append('offset', offset);

                const response = await fetch(`search_images.php?${params.toString()}`);
                const data = await response.json();

                if (data.success) {
                    currentResults = data;
                    statusDiv.innerHTML = `<div class="status success">‚úÖ ${data.total} imagens encontradas</div>`;
                    displayImages(data.data);
                    displayPagination(data);
                } else {
                    statusDiv.innerHTML = `<div class="status error">‚ùå Erro: ${data.error}</div>`;
                }
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">‚ùå Erro: ${error.message}</div>`;
            }
        }

        async function loadAllImages() {
            document.getElementById('searchTerm').value = '';
            document.getElementById('userId').value = '';
            document.getElementById('fileType').value = '';
            document.getElementById('minSize').value = '';
            document.getElementById('maxSize').value = '';
            document.getElementById('dateFrom').value = '';
            document.getElementById('dateTo').value = '';
            document.getElementById('limit').value = '10';
            document.getElementById('offset').value = '0';
            
            await searchImages();
        }

        function clearForm() {
            document.getElementById('searchTerm').value = '';
            document.getElementById('userId').value = '';
            document.getElementById('fileType').value = '';
            document.getElementById('minSize').value = '';
            document.getElementById('maxSize').value = '';
            document.getElementById('dateFrom').value = '';
            document.getElementById('dateTo').value = '';
            document.getElementById('limit').value = '10';
            document.getElementById('offset').value = '0';
            
            document.getElementById('status').innerHTML = '';
            document.getElementById('imageGrid').innerHTML = '';
            document.getElementById('pagination').innerHTML = '';
        }

        function displayImages(images) {
            const imageGrid = document.getElementById('imageGrid');
            imageGrid.innerHTML = '';

            if (images.length === 0) {
                imageGrid.innerHTML = '<p>Nenhuma imagem encontrada.</p>';
                return;
            }

            images.forEach(image => {
                const card = document.createElement('div');
                card.className = 'image-card';
                
                card.innerHTML = `
                    <img src="${image.url || `http://192.168.20.51/textImg/${image.upload_path}`}" 
                         alt="${image.original_name}"
                         onerror="this.parentElement.innerHTML='<div class=status error>‚ùå Erro ao carregar</div>'">
                    <div class="image-info">
                        <h4>${image.original_name}</h4>
                        <p>Tamanho: ${formatFileSize(image.file_size)}</p>
                        <p>Tipo: ${image.file_type}</p>
                        <p>Data: ${image.upload_date}</p>
                        <p>Usu√°rio: ${image.user_id}</p>
                    </div>
                `;
                
                imageGrid.appendChild(card);
            });
        }

        function displayPagination(data) {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            if (!data.has_more && data.offset === 0) return;

            const currentPage = Math.floor(data.offset / data.limit) + 1;
            const totalPages = Math.ceil(data.total / data.limit);

            if (data.offset > 0) {
                const prevButton = document.createElement('button');
                prevButton.textContent = '‚Üê Anterior';
                prevButton.onclick = () => changePage(data.offset - data.limit);
                pagination.appendChild(prevButton);
            }

            const pageInfo = document.createElement('span');
            pageInfo.textContent = `P√°gina ${currentPage} de ${totalPages}`;
            pageInfo.style.margin = '0 20px';
            pageInfo.style.alignSelf = 'center';
            pagination.appendChild(pageInfo);

            if (data.has_more) {
                const nextButton = document.createElement('button');
                nextButton.textContent = 'Pr√≥xima ‚Üí';
                nextButton.onclick = () => changePage(data.offset + data.limit);
                pagination.appendChild(nextButton);
            }
        }

        function changePage(newOffset) {
            document.getElementById('offset').value = newOffset;
            searchImages();
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Carregar todas as imagens ao abrir a p√°gina
        window.onload = function() {
            loadAllImages();
        };
    </script>
</body>
</html>
